deftype alias Error = string

deftype Foo = {
  a: bool
}

fn canFailInt(): Result[int, Error] { .Ok(42) }
fn canFailBool(): Result[bool, Error] { .Ok(false) }

impl Try[T = int, E = Error] for Foo {
  fn makeError(e: E): Self   { { a: false } }
  fn makeSuccess(t: T): Self { { a: true  } }

  fn isSuccess(self: Self): bool { self.a }
  fn getSuccess(self: Self): T  { 3 }
  fn getError(self: Self): E { "FooError" }
}

fn fails(b: bool): Result[bool, Error] {
  let value: Result[int, Error] = .Err("woops");
  let i = try(value);
  .Ok(i % 2 == 0)
}

impl[S, F] Try[T = S, E = F] for Result[S, F] {
  fn makeError(e: E): Self   { .Err(e) }
  fn makeSuccess(t: T): Self { .Ok(t) }

  fn isSuccess(self: Self): bool { self is .Ok(_) }
  fn getSuccess(self: Self): T  { self.asOk()!.value }
  fn getError(self: Self): E { self.asErr()!.value }
}

fn main(): Result[int, Error] {
  let result: int = try(canFailInt());
  assert(result == 42);
  let result: int = try({ a: true }: Foo);
  assert(result == 3);

  let c = \(b: bool -> Result[bool, Error]) {
    let i = try(fails(true));
    .Ok(not i)
  };
  let res = c(false);
  assert(res is .Err("woops"));

  //.Ok(result)
  .Ok(0)
}
