ns json_test;

deftype Json = either
  Null,
  Str(string),
  Number(string),
  Bool(bool),
  Array(List[Json]),
  Object(List[{ key: string, value: Json }])

fn test() {
  let size = core/types/sizeOf[Json]();
  let align = core/types/alignOf[Json]();
  assertEquals(size, 32);
  assertEquals(align, 8);

  let obj: Json = .Str("hello");
  let null: Json = .Null;
  assert(obj is .Str("hello"));
  assert(null is .Null);

  let obj2: Json = .Array([.Str("hello"), .Number("123")]);
  assert(obj2.asArray().!.get(0) is .Str("hello"));
  assert(obj2.asArray().!.get(1) is .Number("123"));

  // TODO: Causes compiler crash due to no indirection
  // type Node = { value: string, child: ?Node }
  // let n: Node = { value: "hello", child: None };
}
